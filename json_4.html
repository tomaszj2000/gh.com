<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script type="text/javascript">
        function draw() {
            var copy = [{
                    "name": "Import danych do bazy danych",
                    "start_time": "2019-05-08",
                    "end_time": "2019-05-10",
                    "status": "new",
                    "parent_id": 34,
                    "id": 36,
                    "assignee": "Bartłomiej Nowak"
                },
                {
                    "name": "Utworzenie modeli bazy danych",
                    "start_time": "2019-05-07",
                    "end_time": "2019-05-08",
                    "status": "new",
                    "parent_id": 34,
                    "id": 35,
                    "assignee": "Justyna Malik"
                },
                {
                    "name": "Utworzenie repozytorium git",
                    "start_time": "2019-05-01",
                    "end_time": "2019-05-06",
                    "status": "new",
                    "parent_id": 29,
                    "id": 33,
                    "assignee": "Justyna Malik"
                },
                {
                    "name": "Sortowanie bąbelkowe",
                    "start_time": "2019-05-01",
                    "end_time": "2019-05-02",
                    "status": "completed",
                    "parent_id": 10,
                    "id": 11,
                    "assignee": "Jan Kowalski"
                },
                {
                    "name": "Sortowanie przez scalanie",
                    "start_time": "2019-05-02",
                    "end_time": "2019-05-03",
                    "status": "pending",
                    "parent_id": 10,
                    "id": 12,
                    "assignee": "Jan Kowalski"
                },

                {
                    "name": "Sortowanie mergsort",
                    "start_time": "2019-05-04",
                    "end_time": "2019-05-05",
                    "status": "new",
                    "parent_id": 10,
                    "id": 14,
                    "assignee": "Bartłomiej Nowak"
                },
                {
                    "name": "Migracja systemu zadań",
                    "start_time": "2019-05-06",
                    "end_time": "2019-05-24",
                    "status": "new",
                    "parent_id": "",
                    "id": 29,
                    "assignee": "Jan Kowalski"
                },
                {
                    "name": "Wyświetlanie zadań na osi czasu",
                    "start_time": "2019-05-07",
                    "end_time": "2019-05-10",
                    "status": "new",
                    "parent_id": "29",
                    "id": 32,
                    "assignee": "Bartłomiej Nowak"
                },
                {
                    "name": "Sortowanie zadań wg. czasu wykonania",
                    "start_time": "2019-05-06",
                    "end_time": "2019-05-07",
                    "status": "new",
                    "parent_id": 29,
                    "id": 31,
                    "assignee": "Bartłomiej Nowak"
                },
                {
                    "name": "Utowrzenie endpointów dla aplikacji web",
                    "start_time": "2019-05-10",
                    "end_time": "2019-05-10",
                    "status": "new",
                    "parent_id": 34,
                    "id": "37",
                    "assignee": "Justyna Malik"
                },
                {
                    "name": "Sortowanie quicksort",
                    "start_time": "2019-05-03",
                    "end_time": "2019-05-04",
                    "status": "new",
                    "parent_id": 10,
                    "id": 13,
                    "assignee": "Bartłomiej Nowak"
                },
                {
                    "name": "Integracja z Django",
                    "start_time": "2019-05-07",
                    "end_time": "2019-05-24",
                    "status": "new",
                    "parent_id": 29,
                    "id": 34,
                    "assignee": "Bartłomiej Nowak"
                },
                {
                    "name": "Algorytmy sortujące",
                    "start_time": "2019-05-01",
                    "end_time": "2019-05-06",
                    "status": "pending",
                    "parent_id": null,
                    "id": 10,
                    "assignee": "Jan Kowalski"
                }
            ]

            var tab1 = []
            //Sortowanie po dacie zakończenia.
            copy.sort(function(a, b) {
                return a.end_time.localeCompare(b.end_time)
            })

            for (i = 0; i < copy.length; i++) {
                tab1[i] = {
                    "name": copy[i].name,
                    "start_time": copy[i].start_time,
                    "end_time": copy[i].end_time,
                    "status": copy[i].status,
                    "parent_id": copy[i].parent_id,
                    "id": copy[i].id,
                    "assignee": copy[i].assignee
                }
            }

            //Zamiana stringa parent_id na number
            for (i = 0; i < copy.length; i++) {
                if (tab1[i].assignee === "Jan Kowalski") {
                    tab1[i].parent_id = 10
                }
                if (tab1[i].parent_id !== Number) tab1[i].parent_id = parseInt(tab1[i].parent_id)
            }

            //Zmienna wysokość rysowania.
            var wy = 0
            var wy_t = 10

            for (i = 0; i < tab1.length; i++) {
                var y = Date.parse(tab1[i].end_time)
                y = y / 1000;
                y = y / 3600;
                y = y / 24;
                var x = Date.parse(tab1[i].start_time)
                x = x / 1000;
                x = x / 3600;
                x = x / 24;
                var DaySum = new Array(tab1.length);
                DaySum[i] = y - x;

                DaySum[i] = DaySum[i] + 1;

                var StartDay = new Array(tab1.length);
                StartDay[i] = Date.parse(tab1[i].start_time) - Date.parse(tab1[0].start_time);
                StartDay[i] = StartDay[i] / 86400000;

                var xx = DaySum[i] + StartDay[i]
                //                DaySum - czas trwania roboty
                //                StartDay - czas rozpoczecia (dzien)
                //Długość czasu pracy + 100 żeby lepiej wyglądało.
                var dl = DaySum[i] * 50
                var canvas = document.getElementById('tutorial');
                if (canvas.getContext) {
                    var ctx = canvas.getContext('2d');

                    ctx.fillStyle = 'rgb(200, 0, 0)';
                    ctx.fillRect(StartDay[i] * 50, wy, dl, 25);
                    ctx.fillStyle = "black"
                    ctx.textAlign = "center"
                    ctx.fillText("P_ID:" + tab1[i].parent_id, StartDay[i] * 50 + dl / 2, wy_t)
                    ctx.fillText("ID:" + tab1[i].id, StartDay[i] * 50 + dl / 2, wy_t + 12)
                }
                //Dodanie wysokości, żeby nie rysowały się na sobie.
                wy = wy + 25
                wy_t = wy_t + 25

            }

            var pom = 0
            for (i = 0; i <= 30; i++) {
                ctx.fillStyle = "black"
                ctx.fillRect(pom, copy.length * 25 + 25, 2, 20)
                ctx.fillRect(pom, copy.length * 25 + 40, 50, 5)
                ctx.fillStyle = "black"
                ctx.fillText(i, pom, copy.length * 25 + 60)
                pom += 50
            }
        }

    </script>
</head>

<body onload="draw()">
    <canvas id="tutorial" width="2000" height="1000"></canvas>
</body>

</html>
